let { CompiledRegex } = import("std/regex");
let { assert } = import("std/testing");
let { compile } = import("../regex.temper");

@test let ok(): Void {
  // Verify that the infrastructure works.
  // Usually, we'll be checking for errors in this file.
  // TODO Remove explicit `void` result if we can adjust java codegen.
  assert(hasResult { compile("ok"); }) { "expected result" }
}

@test let unclosedCapture(): Void {
  // TODO Remove explicit `void` result if we can adjust java codegen.
  assertNoResult { compile("(unclosed"); }
}

@test let unclosedCodePointGroup(): Void {
  assertNoResult { compile("[group-unclosed"); }
}

@test let unclosedNamedCaptureName(): Void {
  assertNoResult { compile("(?name"); }
  assertNoResult { compile("(?name="); }
  assertNoResult { compile("(?"); }
}

let assertNoResult(action: fn(): Void | NoResult): Void {
  assert(!hasResult(action)) { "expected no result" }
}

let hasResult(action: fn(): Void | NoResult): Boolean {
  do {
    action();
    true
  } orelse false
}
